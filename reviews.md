Reviewer: 1

Comments to the Author
General comments:
In this work, the authors proposed a method that compensates for mass cytometry data using bead experiments and a nonparametric finite mixture model. They demonstrate the advantages of their method through simulations and comparisons with previous methods, highlighting its effectiveness in compensating for low counts while preserving channel correlations.

Specific comments:
a) Major:
a1) The author indicated that three to four markers could spill over into the target marker, but in your simulation setting, only one bead channel was simulated. Would introducing multiple bead channels affect the simulation results? I suggest the authors consider increasing K in the simulation settings to better mimic real-world conditions. Additionally, the authors might consider comparing their method with CATALYST in the simulation.
a2) In your real data comparison with CATALYST, Figure 3 results are not explicitly explained. It appears that the two metal labels conjugated to CD3, CD8, and HLA-DR have different spillover conditions, with one metal label experiencing more severe spillover than the other in the original literature. Could the differences observed in Figure 3 be attributed to it? I recommend that the authors address this and provide a justification for their findings based on these spillover conditions.
b) Minor:
b1) On page 9, line 24, the author mentioned that the correlation between HLA-ABC and CD3 was removed by CATALYST. However, this correlation may result from spillover. I suggest the author provide further justification for this statement.

Reviewer: 2

Comments to the Author
In this manuscript Guazzini et al present a new method for compensating mass cytometry data. In contrast to the existing and widely adopted algorithm published by Chevrier et al, which generates a spillover matrix from single stained bead controls, the new method by Guazzini skips the matrix generation step and directly applies signal spillover properties of a single-stained bead experiment to the final cellular data by fitting a mixture model to the observed counts.
While the overall concept seems interesting and adds value to pre-analytical mass cytometry pipelines, I see several major issues that need to be resolved.

Major:
• Looking at the real cytometric data in Fig. 3 (and also in Fig. 1C), it seems to me that spillR is not able to completely remove/correct spillover signals in mass cytometry data. While it removes spillover in the lower signal range (<2) and sets the signal count to NA (see below for critique), it fails to fully correct the obvious spillover in the middle intensity range. For example, in Fig. 3C, the original data show a spillover of 172Yb into the 173Yb channel due to isotopic impurities (the 172Yb preparation contains tiny amounts of other Yb isotopes) and the M+1 spillover effect. As can be seen in the figure, the CATALYST algorithm correctly removes this spillover effect, i.e. the false-positive spillover signal in the 173Yb channel on CD3 (173Yb)-negative cells, which are all HLA-ABC (172Yb)-positive, is removed. The majority of these cells now have zero values. This is very close to the biological picture shown in Fig. 3D, where both channels are technically and spillover-wise not intertwined with each other. In contrast, after correction with spillR, the data still show this false-positive spillover signal in CD3neg cells. The authors acknowledge this difference (page 8, lines 43/44), but misinterpret the "spherical pattern showing a correlation between the two markers" as likely biologically meaningful (page 9, lines 24-26), which only spillR but not CATALYST preserved. The same problem is evident in other examples in Fig. 3, in all cases the spillover is not sufficiently removed and the data do not match the examples in the right-hand panels (i.e. where no signal spillover is expected). From this, I conclude that the spillR algorithm needs to be fundamentally revised to produce results that reflect the true biological situation.

• The authors decided to set count values to NA of events that contain spillover signal to avoid zero-inflated distributions (page 5, last line). This decision is completely incompatible with any flow cytometric data analysis. It violates many flow cytometric assumptions, as assigning NA to such events essentially removes them from the dataset. I would like to emphasize that events (i.e. cells or beads) that show false-positive signals due to spillover in some channels are not “invalid” events that need to be removed from the data set. Their removal alters the overall cellular composition of the biological sample. The effect of masking “NA” cells from the dataset becomes very clear in Fig 3D. In the spillR corrected panel the CD3-negative population is completely removed (probably due to corrections in other channels). Hence, the cellular composition of the corrected data is completely altered. The same can be seen in Fig 3F.
The authors should improve their algorithm (and base concept) so that events with spillover values are not excluded from the data set. For example, the signal could be set to zero, similar to what CATALYST does.

Minor:

• Page 2, lines 34-39 + Fig 1: The entire signal around 2.7 in the 173Yb channel is mainly caused by 172Yb-to-173Yb spillover, not just the left tail of the distribution. The authors should show how spillR compensates the bead data provided in the CATALYST package (in addition to the performance on real cells shown in 1C). After compensation of the bead data the peak around 2.7 should be completely removed.  
• Page 2, lines 50-55 +Fig1C + Table 1: I understand that the authors see the unchanged mean as an advantage. However, the mean of the entire signal distribution in the 173Yb channel in the uncorrected data is a composite of true CD3 staining (around a signal intensity of 6) and mostly false-positive spillover signals from other channels (Biological background: There are no other cells in the dataset that have a true CD3 staining. CD3 is exclusively expressed on CD3 T cells and not by any other cell). Therefore, the observed 173Yb mean of the uncorrected data set is not the true biological mean. The true mean could be determined by an experiment using cells stained with CD3 only, vs. cells stained with a cocktail of antibodies (similar to the data shown in Fig3C). In my opinion a reduced mean (as observed after CATALYST compensation) is not wrong and it is expected that it deviates from the uncorrected mean.
• Page 4, assumption A1: I think this assumption is rarely met in true experiments. From my experience, signals on beads are much more intense than on cells. The authors could check this in the bead and cell data from CATALYST. Since the authors rely on this assumption to only update the target distribution (as described in page 5), perhaps a different formulation of the algorithm might be required.
• Page 4, last paragraph: The author should better use the word “events”. An event could be a bead or a cell.
• Page 8, lines 37/38: The mass “173” is not the sum of neutrons, but the sum of neutrons and protons (or in other words nucleons).
• Page 8, last paragraph: What do the authors mean by “contains different absolute numbers of cells”? Does this refer to the masking of cellular events (“NA”) or is it a graphical problem? Is the visible “fencing” effect due to rounding to the next integer? If yes, it can be easily converted back, by re-applying a randomization step (e.g. a uniform negative Gaussian randomization).
• Page 9, 2nd paragraph: The use of the word counts (not only in this paragraph) can be misleading. The signal intensity in mass cytometry is called “dual counts” and is calculated from real pulse ion counts (lower values) and intensity values (higher values) using the dual count coefficient. In my opinion I would rather use the general term signal intensity. This would help to better distinguish this from "event/cell/bead" counts.
• General: Can spillR be applied also to Imaging Mass Cytometry data? Please discuss.
• General: What happens if a certain spillover is not “covered” in the single-stained bead experiment? Example: The spillover of 193Ir into 194Pt. As DNA is typically stained in 193Ir, it has a very high signal intensity and thus a significant spillover into 194Pt. Unfortunately, it is not possible to perform a bead experiment to generate a control for the 193Ir channel. In case of CATALYST an experimentally determined spillover matrix could be manually adjusted to account for this problem (e.g. using values obtained from cells stained only with the DNA marker). What is the suggestion of the authors to tackle such a problem?
• General: What are the computational requirements for their algorithm? How does it compare to CATALYST in terms of memory usage and computational speed?
• General: The examples provided in the manuscript only compensate Ytterbium (Yb) spillover. How does the time and memory consumption increase when we scale the process to a larger set of isotopes.
• General: Have the authors tested their algorithm on a different dataset than the one provided by CATALYST? (Especially huge datasets with millions of events)
• Attached screenshot from the R-script: It seems that you smooth twice in the script. Can you comment on this?